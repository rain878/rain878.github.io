import tplListItem from"../template/list-item.art";import utils from"./utils";import smoothScroll from"smoothscroll";class List{constructor(t){this.player=t,this.index=0,this.audios=this.player.options.audio,this.showing=!0,this.player.template.list.style.height=`${Math.min(this.player.template.list.scrollHeight,this.player.options.listMaxHeight)}px`,this.bindEvents()}bindEvents(){this.player.template.list.addEventListener("click",(t=>{let e;e="LI"===t.target.tagName.toUpperCase()?t.target:t.target.parentElement;const i=parseInt(e.getElementsByClassName("aplayer-list-index")[0].innerHTML)-1;i!==this.index?(this.switch(i),this.player.play()):this.player.toggle()}))}show(){this.showing=!0,this.player.template.list.scrollTop=33*this.index,this.player.template.list.style.height=`${Math.min(this.player.template.list.scrollHeight,this.player.options.listMaxHeight)}px`,this.player.events.trigger("listshow")}hide(){this.showing=!1,this.player.template.list.style.height=`${Math.min(this.player.template.list.scrollHeight,this.player.options.listMaxHeight)}px`,setTimeout((()=>{this.player.template.list.style.height="0px",this.player.events.trigger("listhide")}),0)}toggle(){this.showing?this.hide():this.show()}add(t){this.player.events.trigger("listadd",{audios:t}),"[object Array]"!==Object.prototype.toString.call(t)&&(t=[t]),t.map((t=>(t.name=t.name||t.title||"Audio name",t.artist=t.artist||t.author||"Audio artist",t.cover=t.cover||t.pic,t.type=t.type||"normal",t)));const e=!(this.audios.length>1),i=0===this.audios.length;this.player.template.list.innerHTML+=tplListItem({theme:this.player.options.theme,audio:t,index:this.audios.length+1}),this.audios=this.audios.concat(t),e&&this.audios.length>1&&this.player.container.classList.add("aplayer-withlist"),this.player.randomOrder=utils.randomOrder(this.audios.length),this.player.template.listCurs=this.player.container.querySelectorAll(".aplayer-list-cur"),this.player.template.listCurs[this.audios.length-1].style.backgroundColor=t.theme||this.player.options.theme,i&&("random"===this.player.options.order?this.switch(this.player.randomOrder[0]):this.switch(0))}remove(t){if(this.player.events.trigger("listremove",{index:t}),this.audios[t])if(this.audios.length>1){const e=this.player.container.querySelectorAll(".aplayer-list li");e[t].remove(),this.audios.splice(t,1),this.player.lrc&&this.player.lrc.remove(t),t===this.index&&(this.audios[t]?this.switch(t):this.switch(t-1)),this.index>t&&this.index--;for(let i=t;i<e.length;i++)e[i].getElementsByClassName("aplayer-list-index")[0].textContent=i;1===this.audios.length&&this.player.container.classList.remove("aplayer-withlist"),this.player.template.listCurs=this.player.container.querySelectorAll(".aplayer-list-cur")}else this.clear()}switch(t){if(this.player.events.trigger("listswitch",{index:t}),void 0!==t&&this.audios[t]){this.index=t;const e=this.audios[this.index];
// set html
this.player.template.pic.style.backgroundImage=e.cover?`url('${e.cover}')`:"",this.player.theme(this.audios[this.index].theme||this.player.options.theme,this.index,!1),this.player.template.title.innerHTML=e.name,this.player.template.author.innerHTML=e.artist?" - "+e.artist:"";const i=this.player.container.getElementsByClassName("aplayer-list-light")[0];i&&i.classList.remove("aplayer-list-light"),this.player.container.querySelectorAll(".aplayer-list li")[this.index].classList.add("aplayer-list-light"),smoothScroll(33*this.index,500,null,this.player.template.list),this.player.setAudio(e),this.player.lrc&&this.player.lrc.switch(this.index),this.player.lrc&&this.player.lrc.update(0),
// set duration time
1!==this.player.duration&&(
// compatibility: Android browsers will output 1 at first
this.player.template.dtime.innerHTML=utils.secondToTime(this.player.duration))}}clear(){this.player.events.trigger("listclear"),this.index=0,this.player.container.classList.remove("aplayer-withlist"),this.player.pause(),this.audios=[],this.player.lrc&&this.player.lrc.clear(),this.player.audio.src="",this.player.template.list.innerHTML="",this.player.template.pic.style.backgroundImage="",this.player.theme(this.player.options.theme,this.index,!1),this.player.template.title.innerHTML="No audio",this.player.template.author.innerHTML="",this.player.bar.set("loaded",0,"width"),this.player.template.dtime.innerHTML=utils.secondToTime(0)}}export default List;