import utils from"./utils";import Icons from"./icons";class Controller{constructor(t){this.player=t,this.initPlayButton(),this.initPlayBar(),this.initOrderButton(),this.initLoopButton(),this.initMenuButton(),utils.isMobile||this.initVolumeButton(),this.initMiniSwitcher(),this.initSkipButton(),this.initLrcButton()}initPlayButton(){this.player.template.pic.addEventListener("click",(()=>{this.player.toggle()}))}initPlayBar(){const t=t=>{let e=((t.clientX||t.changedTouches[0].clientX)-this.player.template.barWrap.getBoundingClientRect().left)/this.player.template.barWrap.clientWidth;e=Math.max(e,0),e=Math.min(e,1),this.player.bar.set("played",e,"width"),this.player.lrc&&this.player.lrc.update(e*this.player.duration),this.player.template.ptime.innerHTML=utils.secondToTime(e*this.player.duration)},e=i=>{document.removeEventListener(utils.nameMap.dragEnd,e),document.removeEventListener(utils.nameMap.dragMove,t);let a=((i.clientX||i.changedTouches[0].clientX)-this.player.template.barWrap.getBoundingClientRect().left)/this.player.template.barWrap.clientWidth;a=Math.max(a,0),a=Math.min(a,1),this.player.bar.set("played",a,"width"),this.player.seek(a*this.player.duration),this.player.disableTimeupdate=!1};this.player.template.barWrap.addEventListener(utils.nameMap.dragStart,(()=>{this.player.disableTimeupdate=!0,document.addEventListener(utils.nameMap.dragMove,t),document.addEventListener(utils.nameMap.dragEnd,e)}))}initVolumeButton(){this.player.template.volumeButton.addEventListener("click",(()=>{this.player.audio.muted?this.player.volume(this.player.audio.volume,!0):(this.player.audio.muted=!0,this.player.switchVolumeIcon(),this.player.bar.set("volume",0,"height"))}));const t=t=>{let e=1-((t.clientY||t.changedTouches[0].clientY)-this.player.template.volumeBar.getBoundingClientRect().top)/this.player.template.volumeBar.clientHeight;e=Math.max(e,0),e=Math.min(e,1),this.player.volume(e)},e=i=>{this.player.template.volumeBarWrap.classList.remove("aplayer-volume-bar-wrap-active"),document.removeEventListener(utils.nameMap.dragEnd,e),document.removeEventListener(utils.nameMap.dragMove,t);let a=1-((i.clientY||i.changedTouches[0].clientY)-this.player.template.volumeBar.getBoundingClientRect().top)/this.player.template.volumeBar.clientHeight;a=Math.max(a,0),a=Math.min(a,1),this.player.volume(a)};this.player.template.volumeBarWrap.addEventListener(utils.nameMap.dragStart,(()=>{this.player.template.volumeBarWrap.classList.add("aplayer-volume-bar-wrap-active"),document.addEventListener(utils.nameMap.dragMove,t),document.addEventListener(utils.nameMap.dragEnd,e)}))}initOrderButton(){this.player.template.order.addEventListener("click",(()=>{"list"===this.player.options.order?(this.player.options.order="random",this.player.template.order.innerHTML=Icons.orderRandom):"random"===this.player.options.order&&(this.player.options.order="list",this.player.template.order.innerHTML=Icons.orderList)}))}initLoopButton(){this.player.template.loop.addEventListener("click",(()=>{this.player.list.audios.length>1?"one"===this.player.options.loop?(this.player.options.loop="none",this.player.template.loop.innerHTML=Icons.loopNone):"none"===this.player.options.loop?(this.player.options.loop="all",this.player.template.loop.innerHTML=Icons.loopAll):"all"===this.player.options.loop&&(this.player.options.loop="one",this.player.template.loop.innerHTML=Icons.loopOne):"one"===this.player.options.loop||"all"===this.player.options.loop?(this.player.options.loop="none",this.player.template.loop.innerHTML=Icons.loopNone):"none"===this.player.options.loop&&(this.player.options.loop="all",this.player.template.loop.innerHTML=Icons.loopAll)}))}initMenuButton(){this.player.template.menu.addEventListener("click",(()=>{this.player.list.toggle()}))}initMiniSwitcher(){this.player.template.miniSwitcher.addEventListener("click",(()=>{this.player.setMode("mini"===this.player.mode?"normal":"mini")}))}initSkipButton(){this.player.template.skipBackButton.addEventListener("click",(()=>{this.player.skipBack()})),this.player.template.skipForwardButton.addEventListener("click",(()=>{this.player.skipForward()})),this.player.template.skipPlayButton.addEventListener("click",(()=>{this.player.toggle()}))}initLrcButton(){this.player.template.lrcButton.addEventListener("click",(()=>{this.player.template.lrcButton.classList.contains("aplayer-icon-lrc-inactivity")?(this.player.template.lrcButton.classList.remove("aplayer-icon-lrc-inactivity"),this.player.lrc&&this.player.lrc.show()):(this.player.template.lrcButton.classList.add("aplayer-icon-lrc-inactivity"),this.player.lrc&&this.player.lrc.hide())}))}}export default Controller;